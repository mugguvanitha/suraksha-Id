{% extends "base.html" %}

{% block title %}User Dashboard - SurakshaID{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Welcome Section -->
        <div class="col-12 mb-4">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h2 class="card-title">
                        <i class="fas fa-user"></i> Welcome, {{ user.name if user.name else 'User' }}!
                    </h2>
                    <p class="card-text">Your Verification ID: <strong>{{ verification_record.VERIFICATION_ID }}</strong></p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Personal Information -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-user-circle"></i> Personal Information</h5>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <td><strong>Full Name:</strong></td>
                            <td>{{ user.name if user.name else 'N/A' }}</td>
                        </tr>
                        <tr>
                            <td><strong>Email:</strong></td>
                            <td>{{ user.email if user.email else 'N/A' }}</td>
                        </tr>
                        <tr>
                            <td><strong>Phone:</strong></td>
                            <td>{{ user.phone if user.phone else 'N/A' }}</td>
                        </tr>
                        <tr>
                            <td><strong>Age:</strong></td>
                            <td>{{ verification_record.AGE }} years</td>
                        </tr>
                        <tr>
                            <td><strong>Government ID Type:</strong></td>
                            <td>{{ verification_record.GOVT_ID_TYPE }}</td>
                        </tr>
                        <tr>
    <td><strong>Government ID Number:</strong></td>
    <td>
        <span id="govtIdMasked">{{ verification_record.MASKED_GOVT_ID }}</span>
        <span id="govtIdFull" style="display:none;">
            {{ user.govt_id_number if user.govt_id_number else 'N/A' }}
        </span>

        <i class="fas fa-eye ms-2"
           style="cursor:pointer;"
           onclick="toggleGovtId()"
           id="eyeIcon"></i>
    </td>
</tr>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Verification Status -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-clipboard-check"></i> Verification Status</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Police Verification Status</label>
                        <div>
                            <span class="status-badge status-{{ verification_record.POLICE_VERIFICATION_STATUS.lower() }}">
                                {{ verification_record.POLICE_VERIFICATION_STATUS }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Address Verification Status</label>
                        <div>
                            <span class="status-badge status-{{ verification_record.ADDRESS_VERIFICATION_STATUS.lower() }}">
                                {{ verification_record.ADDRESS_VERIFICATION_STATUS }}
                            </span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Criminal Verification Status</label>
                        <div>
                            <span class="status-badge status-{{ verification_record.CRIMINAL_VERIFICATION_STATUS.lower() }}">
                                {{ verification_record.CRIMINAL_VERIFICATION_STATUS }}
                            </span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Overall Eligibility Status</label>
                        <div>
                            <span class="status-badge status-{{ verification_record.ELIGIBILITY_STATUS.lower() }}">
                                {{ verification_record.ELIGIBILITY_STATUS }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <small class="text-muted">
                            <i class="fas fa-calendar"></i> Verification Date: {{ verification_record.VERIFICATION_DATE if verification_record.VERIFICATION_DATE else 'N/A' }}
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Address Information -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-map-marker-alt"></i> Address Information</h5>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <td><strong>House Number:</strong></td>
                            <td>{{ verification_record.HOUSE_NO or 'N/A' }}</td>
                        </tr>
                        <tr>
                            <td><strong>Locality:</strong></td>
                            <td>{{ verification_record.LOCALITY or 'N/A' }}</td>
                        </tr>
                        <tr>
                            <td><strong>Village/City:</strong></td>
                            <td>{{ verification_record.VILLAGE or 'N/A' }}</td>
                        </tr>
                        <tr>
                            <td><strong>District:</strong></td>
                            <td>{{ verification_record.DISTRICT or 'N/A' }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <!-- Company Information -->
<div class="col-lg-6 mb-4">
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-building"></i> Company Information
            </h5>
        </div>
        <div class="card-body">
            <table class="table table-borderless">
                <tr>
                    <td><strong>Company Name:</strong></td>
                    <td>{{ verification_record.COMPANY_NAME if verification_record.COMPANY_NAME else 'N/A' }}</td>
                </tr>
                <tr>
                    <td><strong>Employee ID:</strong></td>
                    <td>{{ verification_record.EMP_ID if verification_record.EMP_ID else 'N/A' }}</td>
                </tr>
                <tr>
                    <td><strong>Job Role:</strong></td>
                    <td>{{ verification_record.JOB_ROLE if verification_record.JOB_ROLE else 'N/A' }}</td>
                </tr>
            </table>
        </div>
    </div>
</div>
        <!-- Information Panel -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-info-circle"></i> Important Information</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h6><i class="fas fa-shield-alt"></i> Privacy Notice</h6>
                        <p class="mb-0">Your government ID number is masked for security purposes. Only authorized verification entities can view your complete details.</p>
                    </div>
                    
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-clock"></i> Verification Process</h6>
                        <p class="mb-0">Your verification is currently in progress. Status will be updated as authorized entities complete their reviews.</p>
                    </div>
                    
                    <div class="alert alert-success">
                        <h6><i class="fas fa-check-circle"></i> Next Steps</h6>
                        <p class="mb-0">Once both police and address verifications are marked as CLEAR, your eligibility status will be updated to SAFE.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Status Legend -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-question-circle"></i> Status Legend</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-2">
                            <span class="status-badge status-pending">PENDING</span>
                            <p class="small text-muted mb-0">Verification in progress</p>
                        </div>
                        <div class="col-md-3 mb-2">
                            <span class="status-badge status-clear">CLEAR</span>
                            <p class="small text-muted mb-0">Successfully verified</p>
                        </div>
                        <div class="col-md-3 mb-2">
                            <span class="status-badge status-flagged">FLAGGED</span>
                            <p class="small text-muted mb-0">Issues found</p>
                        </div>
                        <div class="col-md-3 mb-2">
                            <span class="status-badge status-safe">SAFE</span>
                            <p class="small text-muted mb-0">Full access granted</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function toggleGovtId() {
    const masked = document.getElementById("govtIdMasked");
    const full = document.getElementById("govtIdFull");
    const icon = document.getElementById("eyeIcon");

    if (masked.style.display !== "none") {
        masked.style.display = "none";
        full.style.display = "inline";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
    } else {
        masked.style.display = "inline";
        full.style.display = "none";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
    }
}
</script>
<script>
// Auto-refresh every 30 seconds to check for status updates
setInterval(function() {
    // You can implement AJAX call here to refresh status without page reload
    console.log('Checking for status updates...');
}, 30000);

// Add animation to status badges
document.addEventListener('DOMContentLoaded', function() {
    const statusBadges = document.querySelectorAll('.status-badge');
    statusBadges.forEach(function(badge) {
        badge.style.transition = 'all 0.3s ease';
        
        badge.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.05)';
        });
        
        badge.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
    });
});

// Copy verification ID to clipboard
document.addEventListener('DOMContentLoaded', function() {
    const verificationId = '{{ verification_record.VERIFICATION_ID }}';
    if (verificationId) {
        const cardBody = document.querySelector('.card-body p strong');
        if (cardBody) {
            cardBody.style.cursor = 'pointer';
            cardBody.title = 'Click to copy';
            
            cardBody.addEventListener('click', function() {
                navigator.clipboard.writeText(verificationId).then(function() {
                    // Show copied feedback
                    const originalText = cardBody.textContent;
                    cardBody.textContent = 'Copied!';
                    setTimeout(function() {
                        cardBody.textContent = originalText;
                    }, 2000);
                });
            });
        }
    }
});
</script>
{% endblock %}
